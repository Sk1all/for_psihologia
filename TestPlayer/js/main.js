function GetData() {
    return {
        "orgs": [
            {
                "name": "ГМУ Ушакова",
                "groups": [
                    "1 1",
                    "1 2",
                    "1 3"
                ]
            },
            {
                "name": "НКСЭ",
                "groups": [
                    "2 1",
                    "2 2",
                    "2 3"
                ]
            },
            {
                "name": "Что-то ещё",
                "groups": [
                    "3 1",
                    "3 2",
                    "3 3"
                ]
            }
        ],
        "tests": [
            {
                "name": "Зависимое поведение",
                "answerType": "simple",
                "questions": [
                    { "number": 1, "text": "Я постараюсь отнестись к исследованию ответственно и быть максимально искрен-ним (искренней)."},
                    { "number": 2, "text": "У меня очень сложный и трудный для окружающих характер."},
                    { "number": 3, "text": "Я лучше справляюсь с работой в тиши и одиночестве, чем в присутствии многих лю-дей или в шумном месте."},
                    { "number": 4, "text": "Решая серьезные проблемы, я, как правило, обхожусь без посторонней помощи."},
                    { "number": 5, "text": "Я очень редко заговариваю первым (первой) с незнакомыми людьми."},
                    { "number": 6, "text": "Для меня важно, что подумают другие о моих высказываниях и поступках."},
                    { "number": 7, "text": "Если будет нужно, я разрушу все преграды на пути к достижению цели."},
                    { "number": 8, "text": "Я часто тревожусь по пустякам."},
                    { "number": 9, "text": "В моих неудачах виноваты определенные люди."},
                    { "number": 10, "text": "Для меня важно иметь общее мнение с теми людьми, с которыми я обычно общаюсь."},
                    { "number": 11, "text": "Меня мало касается все, что случается с другими."},
                    { "number": 12, "text": "Мне интересны яркие, артистичные личности."},
                    { "number": 13, "text": "Мне нет дела до чужих страданий: хватает своих."},
                    { "number": 14, "text": "В шумной компании я чаще всего в роли только наблюдателя."},
                    { "number": 15, "text": "Для меня невыносимо наблюдать страдания других людей."},
                    { "number": 16, "text": "Я - человек абсолютно правдивый и искренний.а"},
                    { "number": 17, "text": "Все мои беды связаны с собственным неумением ладить с людьми."},
                    { "number": 18, "text": "Меня часто тянет к шумным компаниям."},
                    { "number": 19, "text": "Принимая важное решение, я всегда действую самостоятельно."},
                    { "number": 20, "text": "Мне всегда приятно заводить новых знакомых."},
                    { "number": 21, "text": "Берясь за какое-либо дело, я не стану долго раздумывать, прежде чем начать действо-вать."},
                    { "number": 22, "text": "Меня раздражают люди, пытающиеся изменить мое мнение, когда я уверен(а) в своей правоте."},
                    { "number": 23, "text": "Я часто волнуюсь за близких мне людей даже без серьезного повода."},
                    { "number": 24, "text": "Я не могу терпеть, когда кто-нибудь меняет заведенный мной порядок."},
                    { "number": 25, "text": "Я умею привлекать к себе внимание окружающих меня людей."},
                    { "number": 26, "text": "В жизни я твердо придерживаюсь определенных принципов."},
                    { "number": 27, "text": "Люблю посещать компании, где можно танцевать или петь."},
                    { "number": 28, "text": "Я чрезвычайно чувствителен (чувствительна) к изменениям в настроении окружаю-щих меня людей."},
                    { "number": 29, "text": "Я могу, не смущаясь, дурачиться в веселой компании."},
                    { "number": 30, "text": "Я могу, не смущаясь, дурачиться в веселой компании."},
                    { "number": 31, "text": "Я никогда не поступаю как эгоист (эгоистка)."},
                    { "number": 32, "text": "Часто бывает так, что из-за меня у окружающих портится настроение."},
                    { "number": 33, "text": "Интересные идеи приходят мне в голову чаще, когда я один (одна), не в присутствии многих людей."},
                    { "number": 34, "text": "Я могу взять на себя ответственность за целую группу людей для пользы дела."},
                    { "number": 35, "text": "Мне трудно преодолеть застенчивость, когда нужно говорить перед группой людей."},
                    { "number": 36, "text": "Мнение старших по возрасту или положению большого значения для меня не имеет."},
                    { "number": 37, "text": "Мне не трудно заставить других людей действовать так, как я считаю нужным."},
                    { "number": 38, "text": "Я так сильно переживаю неудачи, что у меня ухудшается самочувствие."},
                    { "number": 39, "text": "Я всегда бываю упрям(а) в тех случаях, когда уверен(а) в своей правоте."},
                    { "number": 40, "text": "Если в компании я не нахожусь в центре внимания, мне становится скучно и неинте-ресно."},
                    { "number": 41, "text": "Никто не может навязать мне свое мнение."},
                    { "number": 42, "text": "Мне нравится путешествовать с разными, каждый раз новыми попутчиками."},
                    { "number": 43, "text": "Я могу изменить свое мнение под давлением окружающих."},
                    { "number": 44, "text": "В поезде я с удовольствием провожу время в беседе с соседями по купе."},
                    { "number": 45, "text": "Я никогда не вру."},
                    { "number": 46, "text": "Я никогда не откладываю на завтра то, что следует сделать сегодня."},
                    { "number": 47, "text": "Я вечно ничем недоволен (недовольна)."},
                    { "number": 48, "text": "Я люблю одиночество, позволяющее мне сосредоточиться на своих мыслях."},
                    { "number": 49, "text": "Я умею заинтересовать людей и повести их за собой."},
                    { "number": 50, "text": "Мне нравится командовать другими."},
                    { "number": 51, "text": "Я умею дать отпор тем, кто вмешивается в мои дела."},
                    { "number": 52, "text": "Мне бывает неловко за высказывания и поступки моих близких"},
                    { "number": 53, "text": "Мне нередко приходилось в драке защищать свои права."},
                    { "number": 54, "text": "Я испытываю чувство вины (или даже стыда), если меня преследуют неудачи."},
                    { "number": 55, "text": "Мое настроение находится в сильной зависимости от настроя тех, кто меня окружает."},
                    { "number": 56, "text": "Я добиваюсь своего упорством и настойчивостью."},
                    { "number": 57, "text": "Мне часто бывает скучно, когда вокруг все веселятся."},
                    { "number": 58, "text": "Мое грустное настроение легко исправляется, если я смотрю в кино или по телевизо-ру комедийное представление."},
                    { "number": 59, "text": "Ради сохранения добрых отношений я могу отказаться от своих намерений."},
                    { "number": 60, "text": "Я всегда придерживаюсь общепринятых правил поведения."},
                    { "number": 61, "text": "Меня любят все мои друзья."},
                    { "number": 62, "text": "У меня трагичная судьба."},
                    { "number": 63, "text": "У меня много близких друзей."},
                    { "number": 64, "text": "Я-самый несчастный человек на свете."},
                    { "number": 65, "text": "Мне проще надеяться на других, чем брать на себя ответственность, даже если речь идет о моих проблемах."},
                    { "number": 66, "text": "Я стараюсь быть таким (такой) «как все», не выделяться среди других."},
                    { "number": 67, "text": "Я - человек спокойный, уравновешенный."},
                    { "number": 68, "text": "Я могу долго не реагировать на чьи-то шутки, но потом «взорваться» гневной реакци-ей."},
                    { "number": 69, "text": "Я очень чувствителен (чувствительна) к изменениям погоды."},
                    { "number": 70, "text": "Я не люблю присутствовать на шумных застольях."},
                    { "number": 71, "text": "Я могу проявить безалаберность в делах, а потом понемногу приводить их в порядок."},
                    { "number": 72, "text": "Я люблю ходить в гости."},
                    { "number": 73, "text": "Мне все равно, что обо мне думают окружающие."},
                    { "number": 74, "text": "Я волнуюсь только по поводу очень больших неприятностей."},
                    { "number": 75, "text": "Я никогда не испытываю желания выругаться."},
                    { "number": 76, "text": "Я никого никогда не обманывал(а)."},
                    { "number": 77, "text": "Мне никто не нужен, и я не нужен (не нужна) никому."},
                    { "number": 78, "text": "Я - человек застенчивый."},
                    { "number": 79, "text": "Мне ужасно не везет в жизни."},
                    { "number": 80, "text": "Я часто стараюсь следовать советам более авторитетной личности."},
                    { "number": 81, "text": "Я бы очень переживал(а), если бы кого-то задел(а) или обидел(а)."},
                    { "number": 82, "text": "Меня ничем не испугать."},
                    { "number": 83, "text": "Я часто пользуюсь чужими советами при решении своих проблем."},
                    { "number": 84, "text": "В своих неудачах я в первую очередь виню самого (саму) себя."},
                    { "number": 85, "text": "Я совершенно не обращаю внимания на свой стиль одежды."},
                    { "number": 86, "text": "Я не стараюсь планировать свое ближайшее будущее и работу."},
                    { "number": 87, "text": "Когда меня зовут в гости, я чаще всего думаю: «Лучше бы мне остаться дома»."},
                    { "number": 88, "text": "Я ничего не знаю о личных проблемах окружающих меня людей."},
                    { "number": 89, "text": "Малейшая неудача резко снижает мое настроение."},
                    { "number": 90, "text": "Я никогда не сержусь."},
                    { "number": 91, "text": "Я отвечал(а) на все вопросы очень правдиво."},
                    
                ]
            },
            {
                "name": "Употребление наркотиков",
                "answerType": "simple",
                "questions": [
                    { "number": 1, "text": "Первый вопрос второго теста"}
                ]
            },
            {
                "name": "Девиантное поведение (МУЖ)",
                "answerType": "extended",
                "questions": [
                    { "number": 1, "text": "Первый вопрос третьего теста"}
                ]
            },
            {
                "name": "Девиантное поведение (ЖЕН)",
                "answerType": "extended",
                "questions": [
                    { "number": 1, "text": "Первый вопрос четвертого теста"}
                ]
            }
        ]
    };
}

let TestData;

let global_wrapper;
let start_screen;

let org_select;
let grp_select;

let test_choose_screen;

let test_buttons;

let test_start_screen;
let current_test_title;

let test_question_screen;

let current_test;
let current_question = 1;

let percents;
let time;
let current_question_text;

let previous_question_button;
let next_question_button;

let finish_test_button;

let test_finish_screen;
let return_to_start_screen_button;

let yes_button;
let no_button;

$(document).ready(function() {
    TestData = GetData();
    //current_test = TestData.tests[0]; //FIXME убрать после теста

    global_wrapper = $("#global-wrapper");

    start_screen = $("#start-screen");
    test_choose_screen = $("#test-choose-screen");
    test_start_screen = $("#test-start-screen");
    current_test_title = $("#current-test-title");

    test_question_screen = $("#test-question-screen");

    percents = $("#percents");
    time = $("#time");
    current_question_text = $("#current-question");

    previous_question_button = $("#previous-question-button");
    next_question_button = $("#next-question-button");
    previous_question_button.click(() => previous_question());
    next_question_button.click(() => next_question());

    finish_test_button = $("#finish-test-button");
    finish_test_button.click(() => finish_test());

    test_finish_screen = $("#test-finish-screen");

    return_to_start_screen_button = $("#return-to-start-screen-button");
    return_to_start_screen_button.click(() => return_to_main_screen());

    org_select = $("#organization-select");
    grp_select = $("#group-select");
    test_buttons = $("#test-buttons");

    yes_button = $("#yes-button");
    no_button = $("#no-button");
    yes_button.click(() => click_answer("yes"));
    no_button.click(() => click_answer("no"));

    org_select.html(create_org_list(TestData.orgs));
    grp_select.html(create_grp_list(TestData.orgs[org_select.val()]));

    org_select.on("change", function() {
        grp_select.html(create_grp_list(TestData.orgs[org_select.val()]));

        org_select.css("background-color", "white");
        org_select.hover((e) => {
            $(this).css("background-color", e.type === "mouseenter" ? "#e7e7e7" : "white");
        })
    });

    grp_select.on("change", function() {
        grp_select.css("background-color", "white");
        grp_select.hover((e) => {
            $(this).css("background-color", e.type === "mouseenter" ? "#e7e7e7" : "white");
        });
    });

    $("#start-testing-button").click(function() {
        hasError = false;

        if (org_select.val() < 0) {
            org_select.css("background", "red");
            hasError = true;
        }

        if (grp_select.val() < 0) {
            grp_select.css("background", "red");
            hasError = true;
        }

        if (!hasError) {
            start_screen.addClass("hidden");
            test_choose_screen.removeClass("hidden");
            global_wrapper.removeClass("bg1");
            global_wrapper.addClass("bg2");

            test_buttons.html(generate_tests_buttons(TestData.tests));
            generate_test_buttons_events(TestData.tests);
        }
    });

    $("#back-to-start-screen-button").click(function() {
        test_choose_screen.addClass("hidden");
        start_screen.removeClass("hidden");
        global_wrapper.removeClass("bg2");
        global_wrapper.addClass("bg1");
    });

    $("#back-to-test-choose-screen-button").click(function() {
        test_start_screen.addClass("hidden");
        test_choose_screen.removeClass("hidden");
    });

    $("#begin-selected-test-button").click(function() {
        let isConfirm = confirm("Приступить к выполнению теста?");
        if (isConfirm) {
            test_start_screen.addClass("hidden");
            test_question_screen.removeClass("hidden");
            begin_test();
        }
    });

    //begin_test(); //FIXME убрать после теста
});

function create_org_list(orgs) {
    if (orgs == null || orgs.length < 1) {
        return create_list_item(-10, "[СПИСОК ПУСТ]");
    }

    let html = create_list_item(-1, "Выберите из списка...");

    for (let i = 0; i < orgs.length; i++) {
        html += create_list_item(i, orgs[i].name);
    }

    return html;
}

function create_grp_list(org) {
    if (org == null || org.groups.length < 1) {
        return create_list_item(-10, "");
    }
    else {
        let html = create_list_item(-1, "Выберите из списка...");

        for (let i = 0; i < org.groups.length; i++) {
            html += create_list_item(i , org.groups[i]);
        }

        return html;
    }
}

function create_list_item(value, text, extTags = "") {
    return `<option value="${value}" ${extTags}>${text}</option>\n`;
}

function generate_tests_buttons(tests) {
    if (tests == null) {
        return "";
    }

    let html = "";
    for (let i = 0; i < tests.length; i++) {
        html += create_test_button(i, tests[i].name);

        $(`#test-${i}-button`).click(function() {
            current_test = TestData.tests[i];
            current_test_title.html(current_test.name);
            test_choose_screen.addClass("hidden");
            test_start_screen.removeClass("hidden");
        });
    }

    return html;
}

function create_test_button(index, name) {
    return `<input type="button" id="test-${index}-button" value="${name}" class="button test-button">\n`;
}

function generate_test_buttons_events(tests) {
    if (tests == null) {
        return;
    }

    for (let i = 0; i < tests.length; i++) {
        $(`#test-${i}-button`).click(function() {
            current_test = TestData.tests[i];
            current_test_title.html(current_test.name);
            test_choose_screen.addClass("hidden");
            test_start_screen.removeClass("hidden");
        });
    }
}

let questions_passed = 1;

let answers = {};

function begin_test() {

    update_current_test_screen();
}

function click_answer(val) {
    answers[current_question] = val;

    if (current_question < current_test.questions.length) {
        current_question++;
    }

    if (questions_passed < current_question) {
        questions_passed = current_question;
    }

    update_current_test_screen();
}

function previous_question() {
    if (current_question > 1) {
        current_question--;
    }

    update_current_test_screen();
}

function next_question() {
    if (current_question < questions_passed) {
        current_question++;
    }

    update_current_test_screen();
}

function update_current_test_screen() {
    current_question_text.html(current_test.questions[current_question - 1].text);

    percents.html(`${questions_passed / current_test.questions.length * 100}%`);

    update_selected_answer(answers[current_question]);

    if (current_question <= 1) {
        previous_question_button.css("display", "none");
    } else {
        previous_question_button.css("display", "block");
    }

    if (current_question >= questions_passed) {
        next_question_button.css("display", "none");
    } else {
        next_question_button.css("display", "block");
    }

    if (Object.keys(answers).length == current_test.questions.length) {
        finish_test_button.css("display", "block");
    } else {
        finish_test_button.css("display", "none");
    }
}

function update_selected_answer(answer) {
    yes_button.removeClass("answered");
    no_button.removeClass("answered");

    if (answer == null) return;

    if (answer == "yes") {
        yes_button.addClass("answered");
    } else if (answer == "no") {
        no_button.addClass("answered");
    }
}

function finish_test() {
    let isFinished = confirm("Завершить прохождение теста?");

    if (!isFinished) return;

    let str = "";
    for (key in answers) {
        str += `${key}: ${answers[key]}\n`;
    }
    alert(str);

    test_question_screen.addClass("hidden");
    test_finish_screen.removeClass("hidden");
}

function return_to_main_screen() {
    location.reload();
}
